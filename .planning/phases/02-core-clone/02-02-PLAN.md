---
phase: 02-core-clone
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - frontend/src/api/types.ts
  - frontend/src/api/client.ts
  - frontend/src/api/hooks.ts
  - frontend/src/components/ralphtown/CloneDialog.tsx
  - frontend/src/components/ralphtown/RepoSelector.tsx
autonomous: true

must_haves:
  truths:
    - "User can open Clone from URL dialog from repo selector dropdown"
    - "User can paste a git URL (SSH or HTTPS) and click Clone"
    - "After successful clone, new repo is selected in repo selector"
    - "Error message shown if clone fails"
  artifacts:
    - path: "frontend/src/components/ralphtown/CloneDialog.tsx"
      provides: "Modal dialog for entering git URL"
      exports: ["CloneDialog"]
    - path: "frontend/src/api/hooks.ts"
      provides: "useCloneRepo mutation hook"
      contains: "useCloneRepo"
    - path: "frontend/src/api/client.ts"
      provides: "cloneRepo API function"
      contains: "cloneRepo"
  key_links:
    - from: "frontend/src/components/ralphtown/CloneDialog.tsx"
      to: "frontend/src/api/hooks.ts"
      via: "useCloneRepo hook"
      pattern: "useCloneRepo"
    - from: "frontend/src/components/ralphtown/RepoSelector.tsx"
      to: "frontend/src/components/ralphtown/CloneDialog.tsx"
      via: "CloneDialog component import"
      pattern: "CloneDialog"
---

<objective>
Implement frontend Clone from URL dialog and integrate with RepoSelector dropdown.

Purpose: Complete the user-facing clone workflow - user opens dialog, enters URL, clicks Clone, new repo is added and selected.
Output: CloneDialog component and "Clone from URL" option in repo selector dropdown.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-clone/02-RESEARCH.md
@.planning/phases/02-core-clone/02-01-SUMMARY.md
@frontend/src/api/types.ts
@frontend/src/api/client.ts
@frontend/src/api/hooks.ts
@frontend/src/components/ralphtown/RepoSelector.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add API types, client function, and hook for clone</name>
  <files>frontend/src/api/types.ts, frontend/src/api/client.ts, frontend/src/api/hooks.ts</files>
  <action>
1. In `types.ts`, add clone request/response types:
```typescript
export interface CloneRepoRequest {
  url: string;
}

export interface CloneRepoResponse {
  repo: Repo;
  message: string;
}
```

2. In `client.ts`, add cloneRepo function (in Repos section):
```typescript
export async function cloneRepo(req: CloneRepoRequest): Promise<CloneRepoResponse> {
  return request<CloneRepoResponse>("/repos/clone", {
    method: "POST",
    body: JSON.stringify(req),
  });
}
```

3. In `hooks.ts`, add useCloneRepo hook (in Repos section, after useScanRepos):
```typescript
export function useCloneRepo() {
  const queryClient = useQueryClient();
  return useMutation({
    mutationFn: (req: CloneRepoRequest) => api.cloneRepo(req),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: queryKeys.repos });
    },
  });
}
```

Also add import for CloneRepoRequest in hooks.ts import statement.
  </action>
  <verify>
TypeScript compiles: `npm run build` in frontend directory succeeds
  </verify>
  <done>
cloneRepo API function and useCloneRepo hook available for frontend use
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CloneDialog component</name>
  <files>frontend/src/components/ralphtown/CloneDialog.tsx</files>
  <action>
Create a new CloneDialog component following the existing Dialog pattern from RepoSelector.tsx:

```typescript
import { useState } from "react";
import { GitBranch } from "lucide-react";
import { Button } from "@/components/ui/button";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { useCloneRepo } from "@/api/hooks";
import { useToast } from "@/hooks/use-toast";
import type { Repo } from "@/api/types";

interface CloneDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onCloneSuccess: (repo: Repo) => void;
}

export function CloneDialog({ open, onOpenChange, onCloneSuccess }: CloneDialogProps) {
  const [gitUrl, setGitUrl] = useState("");
  const cloneRepo = useCloneRepo();
  const { toast } = useToast();

  const handleClone = async () => {
    const trimmedUrl = gitUrl.trim();
    if (!trimmedUrl) {
      toast({
        title: "URL required",
        description: "Enter a git URL to clone.",
        variant: "destructive",
      });
      return;
    }

    try {
      const response = await cloneRepo.mutateAsync({ url: trimmedUrl });
      onCloneSuccess(response.repo);
      setGitUrl("");
      onOpenChange(false);
      toast({
        title: "Repository cloned",
        description: response.message,
      });
    } catch (error) {
      toast({
        title: "Failed to clone repository",
        description: error instanceof Error ? error.message : "Unknown error",
        variant: "destructive",
      });
    }
  };

  const handleOpenChange = (newOpen: boolean) => {
    onOpenChange(newOpen);
    if (!newOpen) {
      setGitUrl("");
    }
  };

  return (
    <Dialog open={open} onOpenChange={handleOpenChange}>
      <DialogContent className="sm:max-w-[480px]">
        <DialogHeader>
          <DialogTitle>Clone from URL</DialogTitle>
          <DialogDescription>
            Enter a git URL (SSH or HTTPS) to clone the repository.
          </DialogDescription>
        </DialogHeader>
        <div className="grid gap-4 py-4">
          <div className="grid grid-cols-4 items-center gap-4">
            <Label htmlFor="gitUrl" className="text-right">
              URL
            </Label>
            <Input
              id="gitUrl"
              value={gitUrl}
              onChange={(e) => setGitUrl(e.target.value)}
              placeholder="https://github.com/user/repo.git"
              className="col-span-3"
              onKeyDown={(e) => {
                if (e.key === "Enter" && !cloneRepo.isPending) {
                  handleClone();
                }
              }}
            />
          </div>
          <p className="text-xs text-muted-foreground ml-auto col-span-3 pr-1">
            Repository will be cloned to ~/ralphtown/
          </p>
        </div>
        <DialogFooter>
          <Button
            variant="outline"
            onClick={() => handleOpenChange(false)}
            disabled={cloneRepo.isPending}
          >
            Cancel
          </Button>
          <Button onClick={handleClone} disabled={cloneRepo.isPending}>
            {cloneRepo.isPending ? "Cloning..." : "Clone"}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

Key features:
- Controlled dialog (open/onOpenChange props)
- URL input with Enter key support
- Loading state during clone
- Success callback with Repo object for parent to select
- Error handling with toast
- Helper text showing clone destination
  </action>
  <verify>
TypeScript compiles: `npm run build` in frontend directory succeeds
  </verify>
  <done>
CloneDialog component created with URL input and clone button
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate CloneDialog into RepoSelector</name>
  <files>frontend/src/components/ralphtown/RepoSelector.tsx</files>
  <action>
Update RepoSelector to include "Clone from URL" option:

1. Add import for CloneDialog:
```typescript
import { CloneDialog } from "./CloneDialog";
```

2. Add import for GitBranch icon (for the menu item):
```typescript
import { ChevronDown, Plus, GitBranch } from "lucide-react";
```

3. Add state for clone dialog:
```typescript
const [isCloneOpen, setIsCloneOpen] = useState(false);
```

4. Add handler for clone success:
```typescript
const handleCloneSuccess = (repo: Repo) => {
  onSelectRepo(mapApiRepoToRepository(repo));
};
```

5. Add import for Repo type:
```typescript
import type { Repo } from "@/api/types";
```

6. Add "Clone from URL" menu item in DropdownMenuContent, after "Add local path...":
```tsx
<DropdownMenuItem
  onSelect={(event) => {
    event.preventDefault();
    setIsCloneOpen(true);
  }}
  className="cursor-pointer text-foreground"
>
  <GitBranch className="mr-2 h-3.5 w-3.5" />
  Clone from URL...
</DropdownMenuItem>
```

7. Add CloneDialog component after the existing Dialog (inside the parent div):
```tsx
<CloneDialog
  open={isCloneOpen}
  onOpenChange={setIsCloneOpen}
  onCloneSuccess={handleCloneSuccess}
/>
```
  </action>
  <verify>
TypeScript compiles: `npm run build` in frontend directory succeeds
  </verify>
  <done>
"Clone from URL" option appears in repo selector dropdown, opens CloneDialog when clicked
  </done>
</task>

</tasks>

<verification>
1. `npm run build` in frontend - compiles successfully
2. `npm run dev` - start frontend dev server
3. Open browser, click repo selector dropdown
4. Verify "Clone from URL..." option appears
5. Click "Clone from URL...", verify dialog opens
6. Enter a public repo URL (e.g., https://github.com/octocat/Hello-World.git)
7. Click Clone, verify spinner shows, then success toast
8. Verify new repo appears in dropdown and is selected
</verification>

<success_criteria>
- "Clone from URL..." option visible in repo selector dropdown
- Clicking opens CloneDialog with URL input
- Pasting URL and clicking Clone initiates clone operation
- On success: toast shown, dialog closes, repo added to list, repo selected
- On error: toast shown with error message
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-clone/02-02-SUMMARY.md`
</output>
