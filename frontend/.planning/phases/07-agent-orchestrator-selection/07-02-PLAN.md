---
phase: 07-agent-orchestrator-selection
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - frontend/src/api/types.ts
  - frontend/src/constants/index.ts
  - frontend/src/components/ralphtown/OrchestratorSelector.tsx
  - frontend/src/components/ralphtown/PromptInput.tsx
  - frontend/src/components/ralphtown/MainPanel.tsx
  - frontend/src/pages/Index.tsx
autonomous: true

must_haves:
  truths:
    - "User can select orchestrator from dropdown when starting session"
    - "Ralph option is selectable and works"
    - "GSD and Gastown show 'Coming Soon' badge and are disabled"
    - "Selected orchestrator is passed to createSession API call"
    - "Default selection is Ralph"
  artifacts:
    - path: "frontend/src/api/types.ts"
      provides: "Orchestrator type and updated Session/CreateSessionRequest interfaces"
      contains: "Orchestrator"
    - path: "frontend/src/constants/index.ts"
      provides: "orchestrators array with enabled/disabled status"
      contains: "orchestrators"
    - path: "frontend/src/components/ralphtown/OrchestratorSelector.tsx"
      provides: "Dropdown component with Coming Soon badges"
      min_lines: 30
    - path: "frontend/src/components/ralphtown/MainPanel.tsx"
      provides: "Wiring layer passing orchestrator from PromptInput to Index.tsx"
      contains: "orchestrator"
    - path: "frontend/src/pages/Index.tsx"
      provides: "Wiring of orchestrator to createSession"
      contains: "orchestrator"
  key_links:
    - from: "frontend/src/components/ralphtown/OrchestratorSelector.tsx"
      to: "frontend/src/constants/index.ts"
      via: "orchestrators import"
      pattern: "import.*orchestrators"
    - from: "frontend/src/components/ralphtown/PromptInput.tsx"
      to: "frontend/src/components/ralphtown/MainPanel.tsx"
      via: "onSubmit callback with orchestrator"
      pattern: "onSubmit.*orchestrator"
    - from: "frontend/src/components/ralphtown/MainPanel.tsx"
      to: "frontend/src/pages/Index.tsx"
      via: "onStartSession callback with orchestrator"
      pattern: "onStartSession.*orchestrator"
    - from: "frontend/src/pages/Index.tsx"
      to: "frontend/src/api/hooks.ts"
      via: "createSession with orchestrator"
      pattern: "createSession.*orchestrator"
---

<objective>
Add orchestrator selector UI to frontend and wire it to session creation.

Purpose: Enable users to visually select which orchestrator runs their session. Ralph is available; GSD and Gastown show "Coming Soon" badges.

Output: OrchestratorSelector component in PromptInput area. Selected orchestrator passed to backend when creating session.
</objective>

<context>
@.planning/phases/07-agent-orchestrator-selection/07-RESEARCH.md
@.planning/phases/07-agent-orchestrator-selection/07-01-SUMMARY.md

# Existing frontend files
@frontend/src/api/types.ts
@frontend/src/constants/index.ts
@frontend/src/components/ralphtown/PromptInput.tsx
@frontend/src/components/ralphtown/MainPanel.tsx
@frontend/src/pages/Index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add frontend types and constants</name>
  <files>
    frontend/src/api/types.ts
    frontend/src/constants/index.ts
  </files>
  <action>
In api/types.ts:
1. Add Orchestrator type near SessionStatus:
```typescript
export type Orchestrator = "ralph" | "gsd" | "gastown";
```
2. Update Session interface to include orchestrator (add after name):
```typescript
export interface Session {
  id: string;
  repo_id: string;
  name: string | null;
  orchestrator: Orchestrator;  // NEW
  status: SessionStatus;
  created_at: string;
  updated_at: string;
}
```
3. Update CreateSessionRequest to include optional orchestrator:
```typescript
export interface CreateSessionRequest {
  repo_id: string;
  name?: string;
  orchestrator?: Orchestrator;  // NEW
}
```
4. Update SessionDetails interface similarly (add orchestrator after name)

In constants/index.ts:
1. Import Orchestrator type at top:
```typescript
import type { Orchestrator } from "@/api/types";
```
2. Add OrchestratorOption interface and orchestrators array:
```typescript
export interface OrchestratorOption {
  id: Orchestrator;
  name: string;
  description: string;
  enabled: boolean;
}

export const orchestrators: OrchestratorOption[] = [
  { id: "ralph", name: "Ralph", description: "CLI-based agent orchestrator", enabled: true },
  { id: "gsd", name: "GSD", description: "Getting Stuff Done framework", enabled: false },
  { id: "gastown", name: "Gastown", description: "Multi-agent orchestration", enabled: false },
];

export const defaultOrchestrator: Orchestrator = "ralph";
```
  </action>
  <verify>
`npm run build` in frontend directory compiles without TypeScript errors
  </verify>
  <done>
Orchestrator type exists. Session and CreateSessionRequest include orchestrator field. orchestrators constant has 3 options with enabled status.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create OrchestratorSelector component</name>
  <files>
    frontend/src/components/ralphtown/OrchestratorSelector.tsx
  </files>
  <action>
Create new file frontend/src/components/ralphtown/OrchestratorSelector.tsx:

```tsx
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Badge } from "@/components/ui/badge";
import { orchestrators, type OrchestratorOption } from "@/constants";
import type { Orchestrator } from "@/api/types";

interface OrchestratorSelectorProps {
  value: Orchestrator;
  onChange: (value: Orchestrator) => void;
  disabled?: boolean;
}

export function OrchestratorSelector({
  value,
  onChange,
  disabled,
}: OrchestratorSelectorProps) {
  // Find current selection for display
  const selected = orchestrators.find((o) => o.id === value);

  return (
    <Select
      value={value}
      onValueChange={(v) => onChange(v as Orchestrator)}
      disabled={disabled}
    >
      <SelectTrigger className="w-[140px] h-8">
        <SelectValue>{selected?.name || value}</SelectValue>
      </SelectTrigger>
      <SelectContent>
        {orchestrators.map((orch) => (
          <SelectItem
            key={orch.id}
            value={orch.id}
            disabled={!orch.enabled}
            className="cursor-pointer"
          >
            <div className="flex items-center gap-2">
              <span>{orch.name}</span>
              {!orch.enabled && (
                <Badge
                  variant="secondary"
                  className="text-[10px] px-1.5 py-0 font-normal"
                >
                  Coming Soon
                </Badge>
              )}
            </div>
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
  );
}
```

Ensure Badge component is available - it should be from shadcn. If not installed, run:
`npx shadcn@latest add badge`
  </action>
  <verify>
Component file exists and exports OrchestratorSelector. TypeScript has no errors.
  </verify>
  <done>
OrchestratorSelector component renders dropdown with 3 options. Ralph is selectable. GSD and Gastown are disabled with "Coming Soon" badge.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate OrchestratorSelector into UI and wire to session creation</name>
  <files>
    frontend/src/components/ralphtown/PromptInput.tsx
    frontend/src/components/ralphtown/MainPanel.tsx
    frontend/src/pages/Index.tsx
  </files>
  <action>
**In PromptInput.tsx:**
1. Add imports:
```typescript
import { OrchestratorSelector } from "./OrchestratorSelector";
import { defaultOrchestrator } from "@/constants";
import type { Orchestrator } from "@/api/types";
```
2. Update PromptInputProps interface to include orchestrator:
```typescript
interface PromptInputProps {
  onSubmit: (prompt: string, model: string, orchestrator: Orchestrator) => void;
}
```
3. Add orchestrator state:
```typescript
const [selectedOrchestrator, setSelectedOrchestrator] = useState<Orchestrator>(defaultOrchestrator);
```
4. Update handleSubmit to pass orchestrator:
```typescript
const handleSubmit = () => {
  if (prompt.trim()) {
    onSubmit(prompt, selectedModel, selectedOrchestrator);
    setPrompt("");
  }
};
```
5. Add OrchestratorSelector to the bottom bar, before the model dropdown:
```tsx
{/* Bottom bar */}
<div className="flex items-center justify-between px-3 py-2 border-t border-border">
  <div className="flex items-center gap-2">
    <OrchestratorSelector
      value={selectedOrchestrator}
      onChange={setSelectedOrchestrator}
    />
    <DropdownMenu>
      {/* existing model selector */}
    </DropdownMenu>
  </div>
  {/* ... rest of bottom bar */}
</div>
```

**In MainPanel.tsx:**
1. Add Orchestrator type import:
```typescript
import type { Repo, Orchestrator } from "@/api/types";
```
2. Update MainPanelProps.onStartSession type to include orchestrator parameter:
```typescript
interface MainPanelProps {
  activeInstance: RalphtownInstance | null;
  onStartSession: (prompt: string, repo: Repository, branch: string, model: string, orchestrator: Orchestrator) => void;
  onSendMessage: (instanceId: string, message: string) => void;
  onCancel?: (instanceId: string) => void;
  repos: Repo[];
  outputLines?: OutputLine[];
}
```
3. Update handleSubmit function signature to accept orchestrator:
```typescript
const handleSubmit = (prompt: string, model: string, orchestrator: Orchestrator) => {
  if (selectedRepo) {
    onStartSession(prompt, selectedRepo, selectedBranch, model, orchestrator);
  }
};
```
Note: The PromptInput component already passes orchestrator to onSubmit, and handleSubmit now forwards it to onStartSession.

**In Index.tsx:**
1. Import Orchestrator type:
```typescript
import type { Repo, SessionStatus, Orchestrator } from "@/api/types";
```
2. Update handleStartSession signature to accept orchestrator:
```typescript
const handleStartSession = async (
  prompt: string,
  repo: Repository,
  branch: string,
  _model: string,
  orchestrator: Orchestrator
) => {
```
3. Pass orchestrator in createSession.mutateAsync:
```typescript
const session = await createSession.mutateAsync({
  repo_id: repo.id,
  name: prompt.length > 30 ? prompt.slice(0, 30) + "..." : prompt,
  orchestrator,  // NEW
});
```
  </action>
  <verify>
`npm run build` compiles without errors.
`npm run dev` - Application loads, orchestrator dropdown visible in prompt area.
Selecting GSD or Gastown is disabled.
Creating a session with ralph orchestrator works end-to-end.
  </verify>
  <done>
OrchestratorSelector appears in PromptInput UI. User can select Ralph (default). GSD/Gastown are disabled with badge. Selected orchestrator flows through PromptInput -> MainPanel -> Index.tsx -> createSession API.
  </done>
</task>

</tasks>

<verification>
1. Build: `npm run build` succeeds without TypeScript errors
2. UI: Orchestrator dropdown visible next to model selector
3. Disabled: GSD and Gastown options show "Coming Soon" badge and cannot be selected
4. Default: Ralph is pre-selected when starting new session
5. API: Network request to POST /api/sessions includes orchestrator field
6. E2E: Create session with Ralph, run prompt - works as before
</verification>

<success_criteria>
- Orchestrator type and constants defined
- OrchestratorSelector component renders dropdown with badges
- PromptInput includes OrchestratorSelector
- MainPanel passes orchestrator from PromptInput to Index.tsx
- Index.tsx passes orchestrator to createSession
- Ralph is default and works
- GSD/Gastown are disabled with "Coming Soon" badge
- Frontend builds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-agent-orchestrator-selection/07-02-SUMMARY.md`
</output>
